<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerar Prova - Dedicandos</title>
  <link rel="shortcut icon" href="/static/images/logo.png" type="image/x-icon">
  <link rel="stylesheet" href="/static/css/gerarProva.css">
  <link rel="stylesheet" href="/static/css/dashboard.css">
</head>

<body>
  <nav class="sidebar">
    <a href="/" class="logo">
            <img src="/static/images/logo.png" alt="Logo">
        </a>
    <a href="/home">InÃ­cio</a>
    <a href="/perfil">Meu Perfil</a>
    <a href="/prova/gerar/form" class="active">Gerar Prova</a>
    <% if (user && user.role==='admin' ) { %>
      <a href="/users">Gerenciar UsuÃ¡rios</a>
      <% } %>
        <a href="/logout" class="logout-btn">Sair</a>
  </nav>

  <div class="main">
    <header class="topbar">
      <span class="welcome-text">Bem-vindo, <%= user.nome %>!</span>
      <img src="/static/uploads/<%= user.avatar_url || 'user.png' %>" alt="Avatar do UsuÃ¡rio" class="avatar">
    </header>

    <main class="dashboard-content">
      <h1>Gerar Prova ENEM</h1>

      <% if (error) { %>
        <p class="error">
          <%= error %>
        </p>
        <% } %>

          <form method="GET" action="/prova/gerar">
            <label for="year">Ano da Prova</label>
            <select id="year" name="year" required>
              <% const year=[2023,2022,2021,2020,2019,2018,2017,2016,2015,2014,2013,2012,2011,2010,2009]; %>
                <% year.forEach(ano=> { %>
                  <option value="<%= ano %>" <%=ano==year ? "selected" : "" %>><%= ano %>
                  </option>
                  <% }) %>
            </select>

            <label for="quantity">Quantidade de QuestÃµes</label>
            <input type="number" id="quantity" name="quantity" min="1" max="180" value="<%= quantity || 10 %>" required>

            <label for="disciplina">Disciplina</label>
            <select id="disciplina" name="disciplina">
              <option value="linguagens" <%=disciplina==='linguagens' ? 'selected' : '' %>>Linguagens e CÃ³digos</option>
              <option value="humanas" <%=disciplina==='humanas' ? 'selected' : '' %>>CiÃªncias Humanas</option>
              <option value="natureza" <%=disciplina==='natureza' ? 'selected' : '' %>>CiÃªncias da Natureza</option>
              <option value="matematica" <%=disciplina==='matematica' ? 'selected' : '' %>>MatemÃ¡tica</option>
            </select>
            Â  Â  Â  Â  Â  Â  <button type="submit">Gerar Prova</button>
            Â  Â  Â  Â  Â 
          </form>
          Â  Â  Â  Â  Â  <div class="section">
            Â  Â  Â  Â  Â  Â  <h2>ðŸ“˜ QuestÃµes Originais do ENEM</h2>
            Â  Â  Â  Â  Â  Â  <% if (questoesOriginais && questoesOriginais.length> 0) { %>

              <form id="form-salvar-prova" method="POST" action="/prova/salvar">
                <input type="hidden" name="ano" value="<%= year %>">
                <input type="hidden" name="disciplina" value="<%= disciplina || 'Todas' %>">

                <label for="titulo-prova">TÃ­tulo da Nova Prova:</label>
                <input type="text" id="titulo-prova" name="titulo" required
                  placeholder="Ex: Simulado ENEM <%= year %> - <%= disciplina || 'Geral' %>">

                <button type="submit" class="btn-salvar">Salvar QuestÃµes Selecionadas</button>

                <% questoesOriginais.forEach((q, idx)=> { %>
                  <% // A API 'enem.dev' usa a propriedade 'number' para o index da questÃ£o na prova const
                    questaoIndex=q.number || (idx + 1); %>

                    <div class="questao">
                      <input type="checkbox" name="questoes_selecionadas" value="<%= questaoIndex %>"
                        id="q_<%= questaoIndex %>" checked>

                      <label for="q_<%= questaoIndex %>">
                        <h4>
                          QuestÃ£o #<%= questaoIndex %>: <%= q.title %>
                        </h4>
                      </label>

                      <p><strong>Disciplina:</strong>
                        <%= q.disciplina || 'Desconhecida' %> | <strong>Idioma:</strong>
                          <%= q.idioma %>
                      </p>
                      <p><%- q.enunciado %></p>
                          <div class="alternativas">
                            <% q.alternativas.forEach(a=> { %>
                              <div class="alternativa <%= a.letra === q.alternativaCorreta ? 'correta' : '' %>">
                                <%= a.letra %>) <%- a.texto %>
                              </div>
                              <% }) %>
                            </div>
                    </div>
                    <% }) %>

                      <button type="submit" class="btn-salvar">Salvar QuestÃµes Selecionadas</button>
              </form>
              <% } else { %>
                <p>Nenhuma questÃ£o do ENEM encontrada. Tente refinar seus filtros.</p>
                <% } %>
          </div>


    </main>
  </div>
</body>

</html>