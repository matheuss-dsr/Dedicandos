<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Perfil do Usuário</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Reset básico */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0 1rem;
      color: #333;
      line-height: 1.5;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .perfil-container {
      background-color: #fff;
      max-width: 600px;
      width: 100%;
      padding: 2rem 2.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      text-align: center;
      box-sizing: border-box;
    }

    .perfil-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 1.5rem;
      border: 4px solid #007bff;
      background-color: #e9ecef;
    }

    .perfil-nome {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: #222;
    }

    .perfil-email {
      font-size: 1rem;
      color: #555;
      margin-bottom: 2rem;
      word-break: break-word;
    }

    .perfil-info {
      text-align: left;
      margin-top: 1rem;
      font-size: 1rem;
      color: #444;
    }

    .perfil-info p {
      margin: 0.5rem 0;
    }

    .perfil-info label {
      font-weight: 600;
      display: inline-block;
      width: 140px;
      color: #222;
    }

    .btn-editar,
    .btn-esqueci,
    .btn-deletar {
      display: inline-block;
      margin-top: 1.5rem;
      padding: 0.75rem 2rem;
      border-radius: 6px;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
      box-shadow: 0 2px 6px rgba(0, 123, 255, 0.4);
      user-select: none;
    }

    .btn-editar {
      background-color: #007bff;
      color: #fff;
      margin-right: 0.5rem;
    }
    .btn-editar:hover,
    .btn-editar:focus {
      background-color: #0056b3;
      outline: none;
      box-shadow: 0 0 8px rgba(0, 86, 179, 0.7);
    }

    .btn-esqueci {
      background-color: #6c757d;
      color: #fff;
      margin-right: 0.5rem;
      box-shadow: 0 2px 6px rgba(108, 117, 125, 0.4);
    }
    .btn-esqueci:hover,
    .btn-esqueci:focus {
      background-color: #5a6268;
      outline: none;
      box-shadow: 0 0 8px rgba(90, 98, 104, 0.7);
    }

    .btn-deletar {
      background-color: #dc3545;
      color: #fff;
      box-shadow: 0 2px 6px rgba(220, 53, 69, 0.4);
    }
    .btn-deletar:hover,
    .btn-deletar:focus {
      background-color: #b02a37;
      outline: none;
      box-shadow: 0 0 8px rgba(176, 42, 55, 0.7);
    }

    /* Responsividade */
    @media (max-width: 480px) {
      .perfil-container {
        padding: 1.5rem 1.5rem;
      }

      .perfil-nome {
        font-size: 1.5rem;
      }

      .perfil-info label {
        width: 120px;
      }

      .btn-editar,
      .btn-esqueci,
      .btn-deletar {
        display: block;
        width: 100%;
        margin: 0.75rem 0 0 0;
      }
    }

    /* Classe para esconder visualmente mas manter acessível para leitores de tela */
    .sr-only {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0, 0, 0, 0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }
  </style>
</head>
<body>
  <main class="perfil-container" role="main" aria-label="Perfil do usuário">
  <form id="form-avatar" action="/users/<%= user.id_usuario %>/upload-avatar" method="POST" enctype="multipart/form-data" style="position: relative;">
    <div style="position: relative; display: inline-block;">
      <img
        class="perfil-avatar"
        id="perfil-avatar-img"
        src="<%= user.avatar_url ? '/static/uploads/' + user.avatar_url : '/static/images/user.png' %>"
        alt="Foto de perfil de <%= user.nome %>"
        tabindex="0"
      />
      <img
        id="edit-avatar-btn"
        src="/static/images/edit.png"
        alt="Editar avatar"
        style="
          position: absolute;
          bottom: 0;
          right: 0;
          width: 28px;
          height: 28px;
          cursor: pointer;
        "
        title="Clique para trocar a foto de perfil"
      />
    </div>

    <input type="file" id="avatar-input" name="avatar" accept="image/*" style="display:none">
  </form>

  <h1 class="perfil-nome"><%= user.nome %></h1>
  <p class="perfil-email" title="Email do usuário"><%= user.email %></p>

  <section class="perfil-info" aria-labelledby="info-title">
    <h2 id="info-title" class="sr-only">Informações do usuário</h2>
    <p><label>Data de nascimento:</label> <span><%= user.data_nascimento %></span></p>
    <p><label>Data de cadastro:</label> <span><%= user.data_cadastro %></span></p>
  </section>

  <div role="group" aria-label="Ações do perfil" style="margin-top: 2rem;">
    <div>
      <a href="/users/<%= user.id_usuario %>/editar" class="btn-editar" aria-label="Editar perfil de <%= user.nome %>">
        Editar Perfil
      </a>

      <a href="/esqueci-senha" class="btn-esqueci" aria-label="Trocar senha">
        Trocar Senha
      </a>
    </div>

    <div style="margin-top: 1rem;">
      <form action="/users/<%= user.id_usuario %>/delete" method="POST" onsubmit="return confirm('Tem certeza que deseja deletar seu perfil? Esta ação não pode ser desfeita.')">
        <button type="submit" class="btn-deletar" aria-label="Deletar perfil de <%= user.nome %>">
          Deletar Perfil
        </button>
      </form>
    </div>
  </div>
</main>

<script>
const avatarInput = document.getElementById('avatar-input');
const avatarImg = document.getElementById('perfil-avatar-img');
const editBtn = document.getElementById('edit-avatar-btn');
const formAvatar = document.getElementById('form-avatar');

editBtn.addEventListener('click', () => {
  const confirmChange = confirm("Deseja realmente trocar a foto de perfil?");
  if (confirmChange) {
    avatarInput.click();
  }
});

avatarInput.addEventListener('change', () => {
  if (avatarInput.files && avatarInput.files[0]) {
    const reader = new FileReader();
    reader.onload = e => avatarImg.src = e.target.result; // preview instantâneo
    reader.readAsDataURL(avatarInput.files[0]);

    // Envia o form para atualizar o backend
    formAvatar.submit();
  }
});

avatarImg.addEventListener('keydown', e => {
  if (e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    const confirmChange = confirm("Deseja realmente trocar a foto de perfil?");
    if (confirmChange) {
      avatarInput.click();
    }
  }
});

</script>
</body>
</html>
